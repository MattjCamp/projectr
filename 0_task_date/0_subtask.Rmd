---
title: "SUBTASK"
output:
  html_document:
    css: ../style.css
    toc: yes
  pdf_document:
    toc: yes
---

```{r warning = FALSE, message = FALSE, echo = FALSE}

source("functions/load.code.R")

```

# Overview

This is an example of a QC Analysis that is meant to be used as a quick
start template. The problem here is that the fulfiller analyst created a statistical
table that shows enrollments over a ten year period broken out by gender. My task is
to pull the same data from our database (included in the `dbr` package) by applying
our rules so that I can compare our two datasets and to verify the analysis.

# QC Analysis

## Read Fulfiller Data In

```{r warning = FALSE, message = FALSE, echo = TRUE}

f <- 
  read_excel("data-sources/enrolled_by_gender.xlsx",
             sheet = "data")

# MINOR CLEANING

f <- f %>% mutate(year = as.integer(year),
                  n = as.integer(n))

f

```

## Replicate Statistical Table

### Get Database Connection

```{r warning = FALSE, message = FALSE, echo = TRUE}

db_file <- system.file("dbr_resources",
                       "example_database.db",
                       package = "dbr")

conn <- init_sqlite(db_file)

```

### Pull Enrollment Data

```{r warning = FALSE, message = FALSE, echo = TRUE}

q <- 
  "select location, year, gender, n
   from wiche_projections_2013
   where grade in ('graduates') 
         and year in (2010,2011,2012,2013,2014)
         and gender not in ('all')
         and race in ('all')
         and sector in ('public')
         and location in ('us')" %>% 
  pull_data(conn)
  
q

```

## Match Datasets

```{r warning = FALSE, message = FALSE, echo = TRUE}

f <- long(f, 2:3)
q <- long(q, 2:3)
dp <- data_points(f, q)

```

`r html_matching_report(dp, "Exact Match WICHE Enrollments")`

# Conclusion

Since we verified the data pull and the results look reasonable I believe that this
analysis is correct.

`r Sys.getenv("USERNAME")`, `r Sys.time()`

```{r warning = FALSE, message = FALSE, echo = FALSE}

source(sprintf("%s/functions/dispose.code.R",
               dirname(getwd())))

```
